{% comment %}
  Elite Pro Framework - High-Performance Product Card
  Updated: Dynamic Aspect Ratio & Safety Image Engine
{% endcomment %}

<div class="elite-pro-card reveal-item" data-product-id="{{ product.id }}">
  <a href="{{ product.url }}" class="card-link-wrapper" aria-label="View {{ product.title | escape }}">
    
    {% comment %} Image Container - Fixed 3:4 Aspect Ratio via CSS {% endcomment %}
    <div class="image-inner glass-panel">
      {%- if product.featured_media -%}
        
        {% comment %} Main Image: Object-fit cover ensures no distortion {% endcomment %}
        {{ product.featured_media | image_url: width: 800 | image_tag:
          loading: 'lazy',
          widths: '300, 600, 800',
          sizes: '(max-width: 768px) 50vw, 25vw',
          class: 'main-card-img',
          alt: product.title | escape
        }}

        {% comment %} Secondary Hover Image: Synced with aspect ratio {% endcomment %}
        {%- if product.media[1] != blank -%}
          {{ product.media[1] | image_url: width: 800 | image_tag:
            loading: 'lazy',
            widths: '300, 600, 800',
            class: 'hover-card-img',
            alt: product.title | escape
          }}
        {%- endif -%}
        
      {%- else -%}
        {% comment %} Placeholder for products without images {% endcomment %}
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg hero-img' }}
      {%- endif -%}
      
      {% comment %} Luxury Badges {% endcomment %}
      <div class="card-badges">
        {%- if product.available == false -%}
          <span class="badge sold-out">OUT OF STOCK</span>
        {%- elsif product.compare_at_price > product.price -%}
          <span class="badge sale">LIMITED OFFER</span>
        {%- endif -%}
      </div>
    </div>

    {% comment %} Product Info Section {% endcomment %}
    <div class="card-info text-center">
      <h3 class="product-title-small">{{ product.title | uppercase }}</h3>
      <div class="product-price-wrapper gold-text">
        {%- if product.compare_at_price > product.price -%}
          <span class="old-price" style="text-decoration: line-through; opacity: 0.6; margin-right: 10px; font-size: 0.9em;">
            {{ product.compare_at_price | money }}
          </span>
        {%- endif -%}
        <span class="current-price">{{ product.price | money }}</span>
      </div>
    </div>
  </a>

  {% comment %} AJAX-Ready Quick Add Form {% endcomment %}
  <form method="post" action="{{ routes.cart_add_url }}" class="quick-add-form elite-product-form" enctype="multipart/form-data">
    <input type="hidden" name="id" value="{{ product.first_available_variant.id }}">
    <input type="hidden" name="quantity" value="1">
    
    <button type="submit" name="add" class="btn-quick-add" {% unless product.available %}disabled{% endunless %} data-cursor-expand>
      <span>
        {%- if product.available -%}
          + QUICK ADD
        {%- else -%}
          SOLD OUT
        {%- endif -%}
      </span>
    </button>
  </form>
</div>

{% comment %} SEO - JSON-LD Structured Data remains the same {% endcomment %}
<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Product",
  "name": {{ product.title | json }},
  "url": {{ shop.url | append: product.url | json }},
  "image": {{ product.featured_image | image_url: width: 800 | json }},
  "description": {{ product.description | strip_html | truncatewords: 30 | json }},
  "offers": {
    "@type": "Offer",
    "priceCurrency": {{ cart.currency.iso_code | json }},
    "price": {{ product.price | money_without_currency | json }},
    "availability": "http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}"
  }
}
</script>
